# 9장 타입 변환과 단축 평가

## 9.1 타입 변환이란?

| 구분                 | 설명                              | 다른 이름      |
| -------------------- | --------------------------------- | -------------- |
| **명시적 타입 변환** | 개발자가 의도적으로 타입을 변환   | 타입 캐스팅    |
| **암묵적 타입 변환** | JS 엔진에 의해 자동으로 타입 변환 | 타입 강제 변환 |

```javascript
var x = 10;

// 명시적 타입 변환
var str = x.toString(); // '10'

// 암묵적 타입 변환
var str = x + ""; // '10'
```

> 타입 변환은 기존 값을 변경하는 것이 아니라 **새로운 값을 생성**하는 것

## 9.2 암묵적 타입 변환

JS 엔진이 표현식을 평가할 때 코드 문맥에 맞게 자동으로 타입을 변환

### 9.2.1 문자열 타입으로 변환

`+` 연산자의 피연산자 중 하나 이상이 문자열이면 문자열 연결 연산자로 동작

```javascript
1 + '2'          // '12'
`1 + 1 = ${1+1}` // '1 + 1 = 2' (템플릿 리터럴)

// 문자열 타입으로 암묵적 변환
0 + ''           // '0'
true + ''        // 'true'
null + ''        // 'null'
undefined + ''   // 'undefined'
({}) + ''        // '[object Object]'
[] + ''          // ''
[10, 20] + ''    // '10,20'
```

### 9.2.2 숫자 타입으로 변환

산술 연산자, 비교 연산자의 피연산자는 숫자 타입으로 변환

```javascript
1 - "1"; // 0
1 * "10"; // 10
1 / "one"; // NaN (변환 불가)

"1" > 0; // true (비교 연산자)
```

**`+` 단항 연산자의 암묵적 변환**

```javascript
+"" + // 0
  "0" + // 0
  "1" + // 1
  "string" + // NaN
  true + // 1
  false + // 0
  null + // 0
  undefined + // NaN
  {} + // NaN
  [] + // 0
  [10, 20]; // NaN
```

### 9.2.3 불리언 타입으로 변환

조건식의 평가 결과는 불리언 타입으로 암묵적 변환

**Falsy 값 (false로 평가)**

| 값          | 설명         |
| ----------- | ------------ |
| `false`     | 불리언 false |
| `undefined` | 미할당       |
| `null`      | 값 없음      |
| `0`, `-0`   | 숫자 0       |
| `NaN`       | Not a Number |
| `''`        | 빈 문자열    |

> **Truthy 값**: Falsy 값 외의 모든 값은 `true`로 평가

```javascript
if ("") console.log("실행 안됨"); // Falsy
if ("str") console.log("실행됨"); // Truthy
if (0) console.log("실행 안됨"); // Falsy
if ([]) console.log("실행됨"); // Truthy (빈 배열은 truthy!)
if ({}) console.log("실행됨"); // Truthy (빈 객체도 truthy!)
```

## 9.3 명시적 타입 변환

개발자가 의도적으로 타입을 변환

### 9.3.1 문자열 타입으로 변환

```javascript
// 1. String 생성자 함수 (new 없이)
String(1); // '1'
String(true); // 'true'

// 2. Object.prototype.toString 메서드
(1).toString(); // '1'
true.toString(); // 'true'

// 3. 문자열 연결 연산자
1 + ""; // '1'
true + ""; // 'true'
```

### 9.3.2 숫자 타입으로 변환

```javascript
// 1. Number 생성자 함수 (new 없이)
Number("0"); // 0
Number(true); // 1

// 2. parseInt, parseFloat (문자열만 가능)
parseInt("0"); // 0
parseFloat("10.53"); // 10.53

// 3. + 단항 산술 연산자
+"0"; // 0
+true; // 1

// 4. * 산술 연산자
"0" * 1; // 0
true * 1; // 1
```

### 9.3.3 불리언 타입으로 변환

```javascript
// 1. Boolean 생성자 함수 (new 없이)
Boolean("x"); // true
Boolean(""); // false
Boolean(0); // false
Boolean(1); // true
Boolean(null); // false
Boolean({}); // true

// 2. ! 부정 논리 연산자 두 번 사용
!!"x"; // true
!!""; // false
!!0; // false
!!1; // true
```

## 9.4 단축 평가

### 9.4.1 논리 연산자를 사용한 단축 평가

논리합(`||`) 또는 논리곱(`&&`) 연산자는 **논리 평가를 결정하는 피연산자를 그대로 반환**

```javascript
"Cat" && "Dog"; // 'Dog'
"Cat" || "Dog"; // 'Cat'
```

> **단축 평가**: 표현식을 평가하는 도중 평가 결과가 확정되면 나머지 평가 과정을 생략

| 단축 평가 표현식      | 결과       |
| --------------------- | ---------- |
| `true \|\| anything`  | `true`     |
| `false \|\| anything` | `anything` |
| `true && anything`    | `anything` |
| `false && anything`   | `false`    |

**if문 대체**

```javascript
var done = true;
var message = "";

// if문
if (done) message = "완료";

// 단축 평가로 대체 (truthy일 때 && 사용)
message = done && "완료";

// falsy일 때 || 사용
var done = false;
message = done || "미완료";
```

**객체의 프로퍼티 참조 시 null/undefined 체크**

```javascript
var elem = null;

// elem.value;          // TypeError!
var value = elem && elem.value; // null (에러 방지)
```

**함수 매개변수 기본값 설정**

```javascript
function getStringLength(str) {
  str = str || ""; // undefined 방지
  return str.length;
}

getStringLength(); // 0
getStringLength("hi"); // 2

// ES6 기본값 문법
function getStringLength(str = "") {
  return str.length;
}
```

### 9.4.2 옵셔널 체이닝 연산자 (`?.`)

ES11(ES2020)에서 도입. 좌항이 `null` 또는 `undefined`이면 `undefined` 반환, 아니면 우항의 프로퍼티 참조 계속

```javascript
var elem = null;

// 옵셔널 체이닝
var value = elem?.value; // undefined

// 기존 방식 (&&)
var value = elem && elem.value; // null
```

**`&&`와 `?.`의 차이**

```javascript
var str = "";

// && 연산자: Falsy 값이면 좌항 반환
str && str.length; // '' (빈 문자열 반환)

// 옵셔널 체이닝: null/undefined만 체크
str?.length; // 0 (정상 동작)
```

> `?.`는 `null`/`undefined`만 체크, `&&`는 모든 Falsy 값 체크

### 9.4.3 null 병합 연산자 (`??`)

ES11(ES2020)에서 도입. 좌항이 `null` 또는 `undefined`이면 우항 반환, 아니면 좌항 반환

```javascript
var foo = null ?? "default"; // 'default'
var foo = undefined ?? "default"; // 'default'
var foo = "" ?? "default"; // '' (빈 문자열 유지)
```

**`||`와 `??`의 차이**

```javascript
// || 연산자: 모든 Falsy 값에서 우항 반환
var foo = "" || "default"; // 'default'
var foo = 0 || "default"; // 'default'

// ?? 연산자: null/undefined에서만 우항 반환
var foo = "" ?? "default"; // '' (의도한 빈 문자열 유지)
var foo = 0 ?? "default"; // 0 (의도한 0 유지)
```

| 연산자 | 우항 반환 조건            | 용도                                |
| ------ | ------------------------- | ----------------------------------- |
| `\|\|` | 좌항이 **Falsy**          | 기본값 설정 (Falsy 모두 대체)       |
| `??`   | 좌항이 **null/undefined** | 기본값 설정 (null/undefined만 대체) |
