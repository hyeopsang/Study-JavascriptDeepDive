# 13장 스코프

## 스코프란?

식별자가 유효한 범위를 말한다. 그 범위는 선언된 위치에 따라 달라지게 된다.

스코프의 가장 중요한 역할로는 중복된 식별자의 충돌 문제를 관리하기 위함이다.

```jsx
var x = "global";

function foo() {
  var x = "local";
  console.log(x);
}

foo(); // 결과 : local
console.log(); // 결과 : global
```

## 스코프 종류

### 지역 스코프와 전역 스코프

스코프의 종류로는 지역 스코프와 전역 스코프가 있는데, 전역이란 코드의 가장 바깥쪽을 말하고 지역은 함수 내부를 말한다.

지역 변수는 자신이 선언된 지역과 하위 지역(중첩 함수)에서만 참조할 수 있다.

![image.png](image.png)

### 스코프의 계층적 구조

각 함수는 자신만의 **지역 스코프**를 가진다.

함수가 중첩되면 스코프도 중첩되어 **계층적 구조(부모–자식 관계)**를 형성한다.

이때 중첩 함수의 스코프 입장에서 외부 함수의 지역 스코프를 **상위 스코프**라 한다.

### 함수 레벨 스코프

- 블록 레벨 스코프: 모든 코드 블록(if, for 등)이 지역 스코프를 만든다
- 함수 레벨 스코프: 함수에 의해서만 지역 스코프를 만든다
- var 키워드로 선언된 변수는 오로지 함수의 코드 블록(함수 몸체)만을 지역 스코프로 인정한다
  - 전역에서 선언한 변수를 if, for문에 또 선언하면 재할당됨

### 스코프 체인

**계층적으로 연결된 스코프들의 집합**을 **스코프 체인**이라 한다.

스코프 체인은 **단방향(아래 → 위)** 으로만 연결된다.

**렉시컬 스코프**

함수를 어디서 호출했는지가 아니라, 어디서 정의(선언)했는지에 따라 상위 스코프를 결정한다.

| **구분**             | **렉시컬 스코프 (Lexical Scope)**                       | **동적 스코프 (Dynamic Scope)**                   |
| -------------------- | ------------------------------------------------------- | ------------------------------------------------- |
| **다른 이름**        | 정적 스코프 (Static Scope)                              | -                                                 |
| **결정 시점**        | **함수 정의**가 평가되는 시점                           | **함수 호출**이 실행되는 시점                     |
| **상위 스코프 기준** | 함수를 **어디서 정의했는지**에 따름                     | 함수를 **어디서 호출했는지**에 따름               |
| **특징**             | 코드 작성 시점에 스코프가 확정되므로 예측 가능성이 높음 | 호출 스택(Call Stack)에 따라 상위 스코프가 달라짐 |
| **사용 언어**        | JavaScript, C, Java, Python 등 대부분                   | Perl, Bash Script 등 일부 언어                    |

```jsx
var x = 1;
function foo() {
  var x = 10;
  bar();
}
function bar() {
  console.log(x);
}

foo(); // 1
bar(); // 1
// 자바스크립트는 상위 스코프를 평가시점에 정하므로 bar 함수가 정의된 곳에서 상위스코프를 가진다.
// 따라서 bar()함수의 상위 스코프는 전역이 되고, console.log(x)를 수행하기 위해 x 값을
// 전역 스코프에서 찾게 되고 x를 출력한다.
```
